---
title: Setting up
author: Georgios Kokolatos
date: 11th of April, 2025

custom_chapters:
  - {href: chapter1.html, label: Introduction}
  - {href: chapter2.html, label: Setting up}
  - {href: chapter3.html, label: Schemata}
  - {href: chapter4.html, label: Import OSM Data}
  - {href: chapter5.html, label: Vehicle log}
  - {href: chapter6.html, label: Emergencies}
  - {href: chapter7.html, label: Schema Testing}
  - {href: chapter8.html, label: Application Interface}
  - {href: chapter9.html, label: Generating vehicle data}
  - {href: chapter10.html, label: Routing}

prev_chapter:
  href: chapter1.html
  label: Introduction
  title: Introduction

next_chapter:
  href: chapter3.html
  label: Schemata
  title: Schemata

custom_toc:
  - {href: setting-up, label: 2. Setting up}
  - {href: installation, label: 2.1 Installation}
  - {href: initialization, label: 2.2 Initialization}
  - {href: proper-initialization, label: 2.3 Proper initialization}
  - {href: create-the-database, label: 2.4 Create the database}
  - {href: retrieving-osm-data, label: 2.5 Retrieving OSM data}
---

# 2. Setting up

The goal is to generate an environment which gives access to a dedicated
PostgreSQL server with a dedicated database, all third party binaries,
OpenStreetMap data. 

A key aspect is to have a replicable environment which can be destroyed and
recreated automatically.

By far the most common OS is a \*NIX flavour. We will be using Ubuntu as it is
a very popular one.

## 2.1 Installation

To install basic packages, assuming an Ubuntu or Debian \*NIX variant, first
update repository sources

```bash
curl https://www.postgresql.org/media/keys/ACCC4CF8.asc | \
    sudo apt-key add -
sudo sh -c 'echo "deb http://apt.postgresql.org/pub/repos/apt/ \
    $(lsb_release -cs)-pgdg main" > /etc/apt/sources.list.d/pgdg.list'

```

Then, install PostgreSQL, PostGIS, pgRouting, and the importing tools.

```bash
sudo apt update
sudo apt install -y \
    postgresql-17 \
    postgresql-17-cron \
    postgresql-17-postgis-3 \
    postgresql-17-postgis-3-scripts \
    postgresql-17-pgrouting \
    osm2pgsql \
    osm2pgrouting
```

## 2.2 Initialization

Probably your PostgreSQL server is already running. Stop it and create a local
instance during development. Most probably you need to add the newly installed
binaries in your path.

```bash
export PATH=/usr/lib/postgresql/17/bin:$PATH
pg_ctl -D /var/lib/postgresql/17/main stop
pg_ctl -D ./data initdb
cat <<EOF >> ./data/postgresql.conf
shared_preload_libraries = 'pg_cron'
cron.database_name = 'emergency_vehicles_lesbos'
EOF
pg_ctl -D ./data -l ./data/startup.log start
```

## 2.3 Proper initialization

Obviously one would like to set the appropriate timezones, permissions,
certificates, etc. You can read more [in the
docs](https://www.postgresql.org/docs/current/ssl-tcp.html).

## 2.4 Create the database

Create the database for the project using the Hellenic locale for collations and
UTF8 encoding.

Note the use of *template0*, which is the pristine template. By default
*template1* is used. However it will not allow to alter the default encoding
and locales used during *initdb*. By using *template0* one is able to create a
database without any local modifications. Additionally, it is a good practice to
use *template0* when restoring a dump generated by *pg_dump*.

```bash
psql -c "
    CREATE DATABASE
        emergency_vehicles_lesbos
    ENCODING UTF8
    LOCALE 'el_GR.UTF8'
    TEMPLATE template0
" postgres://georgios@localhost/postgres
```

Do not forget to add a description for future users.

```bash
psql -c "
    COMMENT ON DATABASE
        emergency_vehicles_lesbos
    IS
        'Development database for emergency vehicle coordination project'
" postgres://georgios@localhost/postgres
```

## 2.5 Retrieving OSM data

OpenStreetMap provides the [overpass API](https://wiki.openstreetmap.org/wiki/Overpass_API).
Use a rough bounding box around
Lesbos to download all the data for the island.

```bash
BBOX="25.5619,38.8501,26.9194,39.5453"; \
curl --output "osm/Lesbos.osm" \
    "http://www.overpass-api.de/api/xapi?*\[bbox=${BBOX}\]\[@meta\]"
```
